<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" /> 
    <title>etGrid demo</title>
    <script src="../../lib/jquery.1.9.1.min.js"></script>
    <script src="../../lib/jquery-ui-1.9.2.min.js"></script>
    <!--PQ Grid files-->

    <script src="../../public/etGrid.min.js"></script>

    <script>
        $(function () {
            var data = [{
                    rank: '1',
                    company: 'Exxon Mobil',
                    orderDate: '1977-11-11',
                    revenues: 339938.33,
                    profits: 11231              
                },
                {
                    rank: 2,
                    company: 'Wal-Mart Stores',
                    orderDate: '1977-11-11',
                    revenues: 315654.0,
                    profits: 11231.0
                },
                {
                    rank: 3,
                    company: 'Royal Dutch Shell',
                    orderDate: '1977-11-11',
                    revenues: 306731.1,
                    profits: 25311.0
                },
                {
                    rank: 4,
                    company: 'BP',
                    orderDate: '1977-11-11',
                    revenues: 267600.0,
                    profits: 22341.0
                },
                 {
                    rank: 5,
                    company: 'General Motors',
                    orderDate: '1977-11-11',
                    revenues: 192604.0,
                    profits: -10567.0
                },
                {
                    rank: 6,
                    company: 'Chevron',
                    orderDate: '1977-11-11',
                    revenues: 189481.0,
                    profits: 14099.0
                },
                {
                    rank: 7,
                    company: 'DaimlerChrysler',
                    orderDate: '1977-11-11',
                    revenues: 186106.3,
                    profits: 3536.3
                },
                {
                    rank: 8,
                    company: 'Toyota Motor',
                    orderDate: '1977-11-11',
                    revenues: 185805.0,
                    profits: 12119.6
                },
                {
                    rank: 9,
                    company: 'Ford Motor',
                    orderDate: '1977-11-11',
                    revenues: 177210.0,
                    profits: 2024.0
                },
                /* {
                    rank: 10,
                    company: 'ConocoPhillips',
                    orderDate: '1977-11-11',
                    revenues: 166683.0,
                    profits: 13529.0
                },
                {
                    rank: 11,
                    company: 'General Electric',
                    orderDate: '1977-11-11',
                    revenues: 157153.0,
                    profits: 16353.0
                },
                {
                    rank: 12,
                    company: 'Total',
                    orderDate: '1977-11-11',
                    revenues: 152360.7,
                    profits: 15250.0
                },
                {
                    rank: 13,
                    company: 'ING Group',
                    orderDate: '1977-11-11',
                    revenues: 138235.3,
                    profits: 8958.9
                },
                {
                    rank: 14,
                    company: 'Citigroup',
                    orderDate: '1977-11-11',
                    revenues: 131045.0,
                    profits: 24589.0
                },
                {
                    rank: 15,
                    company: 'AXA',
                    orderDate: '1977-11-11',
                    revenues: 129839.2,
                    profits: 5186.5
                },
                {
                    rank: 16,
                    company: 'Allianz',
                    orderDate: '1977-11-11',
                    revenues: 121406.0,
                    profits: 5442.4
                },
                {
                    rank: 17,
                    company: 'Volkswagen',
                    orderDate: '1977-11-11',
                    revenues: 118376.6,
                    profits: 1391.7
                },
                {
                    rank: 18,
                    company: 'Fortis',
                    orderDate: '1977-11-11',
                    revenues: 112351.4,
                    profits: 4896.3
                },
                {
                    rank: 19,
                    company: 'Cr茅dit Agricole',
                    orderDate: '1977-11-11',
                    revenues: 110764.6,
                    profits: 7434.3
                },
                {
                    rank: 20,
                    company: 'American Intl. Group',
                    orderDate: '1977-11-11',
                    revenues: 108905.0,
                    profits: 10477.0
                }  */
            ]
            var grid = $("#grid_array").etGrid({
                // width: 500,
                columns: [{
                        display: "Rank",
                        align: "right",
                        dataType: "integer",
                        width:120,
                        name: "rank",
                        hidden: false
                    },
                    {
                        display: 'orderDate',
                        align: 'right',
                        name: 'orderDate',
                        width:120,
                        editor: {
                            type: 'date', // 日期编辑框
                            onSelect: function () {
                            },
                            beforeShow: function (input, inst) {

                                /*  return !this.firstOpen; */
                            },
                            onClose: function () {
                            }
                        },
                        /* validations: [{    // 单元格验证
                            type: 'regexp',   // 验证类型 此为正则表达式
                            value: '^[0-9]{4}-[0-9]{2}-[0-9]{2}$',  // 正则规则
                            msg: '输入值不正确'   // 提示信息
                        }] */
                    },
                    {
                        display: "Company",
                        name: "company",
                        width:120,
                        editor: {
                            type: 'select', // 下拉框编辑框
                            valueField : 'id',
                        	textField : 'text',
                            source: [{
                                    label2: 1,
                                    value: "c"
                                },
                                {
                                    value: 2,
                                    label: "java"
                                },
                                {
                                    value: 3,
                                    label: "php"
                                },
                                {
                                    value: 4,
                                    label: "coldfusion"
                                },
                                {
                                    value: 5,
                                    label: "javascript"
                                },
                                {
                                    value: 6,
                                    label: "asp"
                                },
                                {
                                    value: 7,
                                    label: "ruby"
                                }
                            ],
                            // url:   ,
                            autoFocus: true,
                            disabled: false,
                            open: function () {
                            },
                            select: function (ui, item) {
                                // ui.rowData.id = item.label;
                                /* $(this).val(item.item.label);
                                return item.item.label; */
                            },
                            change: function (ui, item) {
                            },
                            focus: function (ui, item) {
                            },
                            close: function () {
                            }
                        },
                        render: function (ui) {

                        },
                        //  validations: [{
                        //     type: function (ui) {
                        //         /* var value = ui.value;
                        //         if ($.inArray(value, [
                        //                 "ColdFusion",
                        //                 "Erlang",
                        //                 "Fortran",
                        //                 "Groovy",
                        //                 "Haskell",
                        //                 "Java"
                        //             ]) == -1) {
                        //             ui.msg = value + "娌℃壘鍒�?;
                        //             $('.pq-editor-focus').css('border-color', '#f00');
                        //         } */
                        //         return false
                        //     }
                        // }] 
                    },
                    {
                        display: "Revenues ($ millions)",
                        align: "right",
                        dataType: "float",
                        width:120,
                        name: "revenues",
                        editor: {
                            type:'textbox'
                        },
                        render: function (ui) {     // 初始化时 复选框置灰 不让选择
                            var rowdata = ui.rowData;
                            if(rowdata.revenues < 150000) {
                                rowdata.disabledcheckbox = true;
                            }
                        }
                    },
                    {
                        display: "Profits ($ millions)",
                        align: "right",
                        dataType: "float",
                        name: "profits",
                        width:120,
                        // minWidth:120,
                        editor: {
                            type:'textbox'
                        }
                    }
                ],
                dataModel: { // 数据加载的有关属性
                   /*  data: data, // 本地属性 数据属性 */
                    location: "local",  // 远程数据时 location 值为remote
                    /* url: ....., */     // 初始化页面时若不加载数据 参数可不用填  url 可以写在query方法里的loadData()参数里;  若加载数据URL可填
                    // recIndx: 'rank' // 列名(最好是所有数据都有其字段值) 必填;  涉及到 记录添加、修改、删除数据的记录, 否则获取不到update、add、delete的数据
                },
                numberCell: {
                    //  show:false,
                    resizable: false,
                    title: "#",
                    width: 30,
                    minWidth: 30
                }, 
                height:300,
                editable: true,
                checkbox: true,
                addRowByKey: true, //  快捷键控制添加行
                resizable: true,
                selectionModel: {
                    type: 'cell', // 选择模式 单元格选择 或 行选择 'cell'/'row'
                    // mode: 'single', //  mode 值 single时 复选框只能单选
                },
                toolbar: {
                    items: [{
                        type: "select",
                        label: '添加',
                        icon: 'circle-plus',
                        disabled:true,
                        options:[1,2,3]
                        // disabled: true, // 初始化禁用按钮
                        /* listeners: [{
                            click: add
                        }] */
                    }, {
                        type: "button",
                        label: '删除',
                        icon: 'delete',
                        listeners: [{
                            click: delete2
                        }]
                    },{
                        type: "button",
                        label: '添加列',
                        icon: 'add',
                        id:'add',
                        listeners: [{
                            click: addCol
                        }]
                    }]
                },
                summary:{         //  摘要行集合 对象
                    totalColumns:['revenues','profits'],
                    keyWordCol:'rank',   //关键字所在列的列名
                    averageColumns:['revenues','profits'],
                    maxColumns:['revenues','profits'],
                    minColumns:['revenues','profits']
                },
                cellBeforeSave: function () {
                },
                cellSave: function (a,ui) {
                    // console.log(a,ui)
                },
                refresh: function () {
                    // console.log(1111)
                },
                render: function () {
                },
                refreshRow:function (){
                    console.log(78878);
                },
                editorBlur: function (event, ui) {
                },
                editorEnd: function () {

                },
                load: function () {

                },
                changeRow: function () {
                },
                change:function (){
                }
            });

            $('#text1').click(function () {
                grid.option('dataModel.data',data);
                /* grid.addRows(data);
                var num = grid.getAllData();
                var selecteds = grid.selectGetChecked();
                var selecteds2 = grid.selectGet();
                grid.refreshSummary() */
                // grid.editCell(num.length - 1, 'revenues');

            });

            $('#text2').click(function () {
                var selected1 = grid.getUpdated();
                var selected2 = grid.getAdded();
                var selected3 = grid.getDeleted();
                grid.refreshSummary()
                // grid.deleteRows(selecteds);
            });

            /*grid.on('keydown', function(evt){
                if(evt.key == 'Tab') {
                    grid.addRow({});
                }
            });*/
            function add() {
                grid.addRow()
            }

            function addCol() {
                var colM = [{
                        dataIndx: "Rank",
                        align: "right",
                        dataType: "integer",
                        title: "rank",
                        width: '15%',
                        editable: false
                    },
                    {
                        dataIndx: 'orderDate',
                        align: 'right',
                        width: 130,
                        title: 'orderDate',
                        editor: {
                            type: 'date', // 日期编辑框
                            onSelect: function () {
                            },
                            beforeShow: function (input, inst) {

                                /*  return !this.firstOpen; */
                            },
                            onClose: function () {
                            }
                        },
                    }]
                grid.option("colModel", colM );
                grid.refresh();
            }
            // grid.addRow();
            function delete2() {
                var selecteds = grid.selectGet();
                var _g = grid.getInstance();
                grid.deleteRows(selecteds);
                grid.refreshSummary()
            }
        });
    </script>
</head>

<body>
    <button id='text1'>添加带编辑框的行</button>
    <button id='text2'>删除2</button>
    <div id="grid_array" style="margin:100px;"></div>
</body>

</html>